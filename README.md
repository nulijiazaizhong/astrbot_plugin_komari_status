# astrbot_plugin_komari_status

AstrBot 的 Komari 服务器状态监控插件。支持查询节点列表、实时状态、公开设置及版本信息。支持生成精美的状态图片，并允许用户自定义触发指令。

![:astrbot_plugin_komari_status](https://count.getloli.com/@:astrbot_plugin_komari_status?theme=minecraft)

## 🛠️ 安装与配置

1. 在 AstrBot 插件市场搜索 `komari_status` 安装。
2. 在 WebUI 的插件配置中填写 `Komari 服务器地址` (必填)。
3. 如果是非公开站点，请填写 `API Token`。

### ⚙️ 详细配置项

| 配置项 (大字标题) | 说明 (小字提示) | 默认值 |
| :--- | :--- | :--- |
| **Komari 服务器地址** | 您的 Komari 面板 URL (如 `https://status.example.com`) | - |
| **API Token** | API Key 或 Session Token (如果是非公开站点则必须) | - |
| **以图片形式发送** | 开启后，状态报告将调用文本转图像服务以图片形式发送 | `false` |
| **是否启用 深色背景** | 开启后，生成的图片将使用深色主题背景 | `true` |
| **图片宽度** | 生成图片的宽度（像素），高度会自动适应内容 | `600` |

## 🎮 指令列表

默认指令如下 (支持正则匹配，可在配置中自定义)：

- **查询节点状态**: `查询 Komari 节点状态`
- **查询实时状态**: `查询 Komari 实时状态`
- **查询公开设置**: `查询 Komari 公开设置`
- **查询版本信息**: `查询 Komari 版本信息`

## ⚡ 自定义短命令 (高级配置)

本插件支持在 WebUI 中通过 **正则表达式** 自定义触发指令。这使得您可以设置更短、更符合习惯的命令。

### 设置方法

在插件配置页面的下方，找到 `...指令(正则)` 相关的配置项进行修改。

### 📝 常用正则示例

#### 示例 1: 简单的短命令
如果您想用 `k状态` 或 `k实时` 来查询：
- **配置项**: `实时状态指令(正则)`
- **填入值**: `(k|komari)\s*(实时|状态)`
- **效果**: 发送 `k实时`、`k状态`、`komari实时` 均可触发。

#### 示例 2: 兼容多种说法 (推荐)
如果您想兼容“查询 k 状态”、“看下服务器”等多种说法：
- **配置项**: `实时状态指令(正则)`
- **填入值**: `(查询|看下)\s*(k|服务器)\s*状态`
- **效果**: 支持 `查询k状态`、`看下服务器状态`。

#### 示例 3: 极简严格匹配
如果您希望只有完全匹配 `node` 时才触发（防止误触）：
- **配置项**: `节点状态指令(正则)`
- **填入值**: `^node$`
- **效果**: 仅发送 `node` 即可触发，发送 `node info` 不会触发。

> **正则小贴士**: 
> - `\s*` 表示允许出现任意数量的空格（包括0个）。
> - `|` 表示“或”，如 `(a|b)` 表示匹配 a 或 b。
> - `^` 表示匹配文本开头，`$` 表示匹配文本结尾。


## 更新日志：

### v1.0.4
- 修复 查询节点状态 命令中节点离线仍显示为在线的问题

### v1.0.3
- 更新输出为图片的模板

### v1.0.2
- 修复 实时状态 'cpu占用率' 显示异常的bug

### v1.0.1
- 修改插件名称

### v1.0.0
- 完成插件的编写